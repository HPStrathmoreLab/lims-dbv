CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_requisition_details` AS select `req`.`id` AS `requisition_number`,`req`.`date_received` AS `date_received`,cast(`req`.`timestamp` as date) AS `date_entered`,`req`.`facility_id` AS `facility_id`,`req`.`program_id` AS `program_id`,`req`.`comments` AS `comments`,`req`.`lab_comments` AS `lab_comments`,`req`.`flag` AS `req_flag`,`req`.`synced` AS `req_synced`,`req`.`timestamp` AS `requisition_timestamp`,`fac`.`name` AS `facility_name`,count(`sa`.`id`) AS `total`,sum((case when (`sa`.`acceptance_status` = 'R') then 1 else 0 end)) AS `rejected`,sum((case when (`tr`.`result` > 0) then 1 else 0 end)) AS `with_results`,`req`.`entered_by` AS `user_id`,`usr`.`name` AS `entered_by` from ((((`test_requisition` `req` left join `facility` `fac` on((`req`.`facility_id` = `fac`.`id`))) left join `sample` `sa` on((`req`.`id` = `sa`.`requisition_id`))) left join `sample_test_run` `tr` on((`sa`.`id` = `tr`.`sample_id`))) left join `user` `usr` on((`req`.`entered_by` = `usr`.`id`))) group by `requisition_number` order by `req`.`date_received` desc limit 500